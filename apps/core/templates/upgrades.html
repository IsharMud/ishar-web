{% extends "layout.html" %}
{% block meta_title %}Remort Upgrades{% endblock meta_title %}
{% block meta_description %}Remort upgrades available to players, and their costs.{% endblock meta_description %}
{% block meta_url %}{% url 'upgrades' %}{% endblock meta_url %}
{% block title %}Remort Upgrades{% endblock title %}
{% block scripts %}
        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        <link rel="stylesheet" href="https://cdn.datatables.net/2.0.1/css/dataTables.bootstrap5.css">
        <script src="https://cdn.datatables.net/2.0.1/js/dataTables.js"></script>
        <script src="https://cdn.datatables.net/2.0.1/js/dataTables.bootstrap5.js"></script>
{% endblock scripts %}
{% block header %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item" title="Portal">
            <span class="bi bi-shield text-ishar"></span>
            <a href="{% url 'portal' %}#portal" id="portal">
                Portal
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page" title="Remort Upgrades">
            <a href="{% url 'upgrades' %}#upgrades" id="upgrades">
                Remort Upgrades
            </a>
        </li>
    </ol>
</nav>
{% endblock header %}
{% block content %}
        <p class="lead">
            Here is a list of the remort upgrades available to players,
            and the renown costs for each upgrade.
        </p>

    {% if upgrades_json %}
        <table class="m-1 p-1" id="upgradesTable"></table>
        {{ upgrades_json|json_script:"upgradesJSON" }}
        <script>
            const remortUpgrades = [];
            const upgradesData = JSON.parse(JSON.parse(document.getElementById("upgradesJSON").textContent));
            function buildUpgrade(upgrade) { remortUpgrades.push(upgrade.fields); };
            upgradesData.forEach(buildUpgrade);
            const pageTable = new DataTable('#upgradesTable', {
                columns: [
                    { data: 'display_name', title: 'Name' },
                    { data: 'renown_cost', title: 'Cost' },
                    { data: 'survival_renown_cost', title: 'Survival Cost' },
                    { data: 'max_value', title: 'Max Value' },
                ],
                columnDefs: [{ type: 'num', targets: [1, 2, 3] }],
                data: remortUpgrades,
                info: false,
                layout: { bottomStart: 'search', topEnd: null },
                order: [0, 'asc'],
                pageLength: 15,
                paging: false,
                scrollX: true,
                searching: false
            });
            pageTable.draw();
        </script>

    {% else %}
        <p class="lead fst-italic">
            Sorry, but no remort upgrades were found.
        </p>
    {% endif %}

    {% if upgrades %}
        <table class="table table-dark border rounded m-1 p-1">
            <thead>
                <tr class="border rounded">
                    <th scope="col" title="#">#</th>
                    <th scope="col" title="Name">Name</th>
                    <th scope="col" title="Tiers">Tiers</th>
                    <th scope="col" title="Survival Tiers">Survival Tiers</th>
                </tr>
            </thead>
        <tbody>
        {% for upgrade in upgrades %}
            <tr class="border rounded">
                <th class="border rounded" scope="row">
                    <a class="anchor-link" id="{{ upgrade.anchor }}" href="#{{ upgrade.anchor }}" aria-label="Link to this section: Remort Upgrades: {{ upgrade.display_name }} ({{ upgrade.anchor }})">
                        &#x23;
                    </a>
                </th>
                <td class="border rounded">
                    <b>{{ upgrade.display_name }}</b>
                </td>
                <td class="border rounded" title="Tiers: {{ upgrade.tiers }}">
                    {{ upgrade.tiers }}
                </td>
                <td class="border rounded" title="Survival Tiers: {{ upgrade.survival_tiers }}">
                    {{ upgrade.survival_tiers }}
                </td>
            </tr>
        {% endfor %}
        </table>
    {% endif %}
{% endblock content %}
