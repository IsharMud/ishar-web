{% extends "layout.html" %}
{% load humanize %}
{% block meta_title %}Challenges{% endblock meta_title %}
{% block meta_description %}Challenges currently available, A.{% endblock meta_description %}
{% block meta_url %}{% url 'challenges' %}{% endblock meta_url %}
{% block title %}Challenges{% endblock title %}
{% block scripts %}
    <link href="https://cdn.datatables.net/2.1.6/css/dataTables.bootstrap5.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/3.1.2/css/buttons.bootstrap5.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/2.1.6/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.1.6/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.1.2/js/dataTables.buttons.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.colVis.js"></script>
{% endblock scripts %}
{% block header %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item" title="Portal">
            <span class="text-ishar bi bi-award"></span>
            <a href="{% url 'portal' %}#portal" id="portal">Portal</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page" title="Challenges">
            <a href="{% url 'challenges' %}#challenges" id="challenges">
                Challenges
            </a>
        </li>
    </ol>
</nav>
{% endblock header %}
{% block content %}
    {% if CURRENT_SEASON and CURRENT_SEASON.get_next_cycle %}
    <div class="next-cycle">
        <p class="lead">
            Challenges will next cycle
            <strong>{{ CURRENT_SEASON.get_next_cycle | naturaltime }}</strong>
            @ {{ CURRENT_SEASON.get_next_cycle }}
        </p>
    </div>
    {% endif %}
    <div class="container-md">
        <table class="table table-dark table-flush table-sm table-responsive table-responsive-sm table-striped" id="challengesTable">
        </table>
    </div>
    {{ challenges|json_script:"challengeJSON" }}
    <script>
        const challenges = [];
        const challengesData = JSON.parse(JSON.parse(document.getElementById("challengeJSON").textContent));
        function buildChallenge(challenge) { challenges.push(challenge.fields); };
        challengesData.forEach(buildChallenge);
        const pageTable = new DataTable('#challengesTable', {
            columns: [
                { data: 'mobile', title: 'Find & Kill' },
                { data: 'max_people', title: 'Max People', search: false },
                { data: 'max_level', title: 'Max Level', search: false },
            ],
            columnDefs: [{ type: 'num', targets: [1, 2] }],
            data: challenges,
            language: {
                info: "Showing _START_ to _END_ of _TOTAL_ challenges",
                infoEmpty: "Showing 0 to 0 of 0 challenges",
                infoFiltered: "(filtered from _MAX_ total challenges)",
                lengthMenu: "Show _MENU_ challenges",
                zeroRecords: "No matching challenges found"
            },
            layout: {
                topStart: {
                    search: { placeholder: 'Mobile Name' }
                },
                bottomStart: {
                    buttons: [{
                        extend: 'colvis',
                        text: 'Columns'
                    }],
                },
                topEnd: 'info'
            },
            order: [[2, 'desc'], [1, 'desc'], ['0', 'asc']],
            paging: false,
            scrollX: true
        });
        pageTable.draw();
    </script>
{% endblock content %}
